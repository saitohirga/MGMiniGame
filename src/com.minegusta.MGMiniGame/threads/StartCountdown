package com.minegusta.MGMiniGame.threads;

import org.bukkit.Bukkit;

import com.minegusta.MGMiniGame.GameState;
import com.minegusta.MGMiniGame.MGMiniGame;
import com.minegusta.MGMiniGame.handlers.Game;
import com.minegusta.MGMiniGame.utils.ChatUtils;

public class StartCountdown implements Runnable
{
	
	private static int timeUntilStart;

	@Override
	public void run() 
	{
		timeUntilStart = 60;
		while (true)
		{
			if(GameState.isState(GameState.IN_LOBBY))
			if (Game.canStart1())
			{
				timeUntilStart = 60;
				ChatUtils.broadcast("Minimum players reached! Countdown starting!");
				for(;timeUntilStart >= 0; timeUntilStart--)
				{
					if(!Game.canStart1())
					{
						ChatUtils.broadcast("Not enough players needed to start! Countdown Stopped!");
						break;
					}
					if(timeUntilStart == 0)
					{
						MGMiniGame.start();
						break;
					}
				
					if(timeUntilStart % 10 == 0 || timeUntilStart<10)
					{
						ChatUtils.broadcast(timeUntilStart + " Seconds until the game starts!");
					}
				
					try
					{
						Thread.sleep(1000);
					}catch(InterruptedException e)
					{
						e.printStackTrace();
						Bukkit.shutdown();
					}			
				}
			}
			try
			{
				Thread.sleep(1000);
			}catch(InterruptedException e)
			{
				e.printStackTrace();
				Bukkit.shutdown();
			}
		}
	}
	
}
